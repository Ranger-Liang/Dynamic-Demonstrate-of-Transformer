<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Station 2: Attention Matrix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body { background-color: #111827; color: white; font-family: 'Consolas', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }

        .stage {
            background: #1f2937; padding: 40px; border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: grid;
            /* 定义网格：第一列是表头，后面是内容 */
            grid-template-columns: 80px repeat(3, 100px);
            grid-template-rows: 60px repeat(2, 80px);
            gap: 10px;
        }

        /* 单元格通用样式 */
        .cell {
            display: flex; align-items: center; justify-content: center;
            border-radius: 8px; font-weight: bold; position: relative;
        }

        /* 表头样式 */
        .header-col { background: #1e3a8a; color: #bfdbfe; border: 1px solid #3b82f6; } /* Key (Blue) */
        .header-row { background: #7f1d1d; color: #fecaca; border: 1px solid #ef4444; } /* Query (Red) */
        
        /* 矩阵内部数字格 */
        .grid-cell {
            background: #374151; color: #9ca3af;
            border: 1px solid #4b5563;
            font-size: 18px;
            transition: 0.3s;
        }

        /* 高分样式 */
        .high-score {
            background: #fbbf24; color: #78350f; border-color: #f59e0b;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
            z-index: 10;
        }

        .label { font-size: 12px; opacity: 0.7; position: absolute; bottom: -20px; }
        
        /* 说明文字 */
        .info { margin-top: 30px; color: #9ca3af; font-family: sans-serif; }
        button { margin-top: 20px; padding: 10px 30px; background: #6366f1; border: none; color: white; border-radius: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Step 2: Attention Matrix</h2>
    
    <div class="stage">
        <!-- 第1行：列标题 (Keys) -->
        <div></div> <!-- 左上角空缺 -->
        <div class="cell header-col">Great</div>
        <div class="cell header-col">Bay</div>
        <div class="cell header-col">Uni</div>

        <!-- 第2行：Query "大" -->
        <div class="cell header-row">大</div>
        <div class="cell grid-cell" id="c-0-0">0.0</div>
        <div class="cell grid-cell" id="c-0-1">0.0</div>
        <div class="cell grid-cell" id="c-0-2">0.0</div>

        <!-- 第3行：Query "学" -->
        <div class="cell header-row">学</div>
        <div class="cell grid-cell" id="c-1-0">0.0</div>
        <div class="cell grid-cell" id="c-1-1">0.0</div>
        <div class="cell grid-cell" id="c-1-2">0.0</div>
    </div>

    <div class="info" id="status">点击按钮计算概率分布</div>
    <button onclick="playMatrix()">计算概率 (Softmax)</button>

<script>
    function playMatrix() {
        const tl = gsap.timeline();
        const status = document.getElementById('status');

        // 模拟的概率数据
        // 第一行 ("大") 比较平均或关注 Great
        const row1Data = [0.85, 0.10, 0.05];
        // 第二行 ("学") 强烈关注 Uni
        const row2Data = [0.02, 0.03, 0.95];

        // 1. 模拟计算过程：数字随机跳动
        status.innerText = "正在进行 Q × K 点积运算...";
        
        // 选中所有格子
        const cells = document.querySelectorAll('.grid-cell');
        
        tl.to(cells, {
            scale: 0.8,
            duration: 0.2,
            backgroundColor: "#4b5563"
        });

        // 2. 填入最终概率 (Softmax)
        tl.call(() => status.innerText = "Softmax 归一化完成，生成概率矩阵");
        
        // 第一行填数
        row1Data.forEach((val, i) => {
            tl.to(`#c-0-${i}`, { 
                innerText: val.toFixed(2), 
                backgroundColor: val > 0.5 ? "rgba(251, 191, 36, 0.3)" : "#374151", // 稍微亮一点
                scale: 1,
                duration: 0.5 
            }, "<0.1");
        });

        // 第二行填数 (这是重点行)
        row2Data.forEach((val, i) => {
            tl.to(`#c-1-${i}`, { 
                innerText: val.toFixed(2), 
                duration: 0.5,
                scale: val > 0.8 ? 1.2 : 1, // 概率大的变大
            }, "<");
        });

        // 3. 高亮重点 (Focus)
        // 假设我们现在要生成 "学"，所以重点看第二行的最后一个格子 (0.95)
        tl.call(() => status.innerText = "聚焦当前生成词：'学' 关注 'Uni' (概率 0.95)");
        
        // 把其他行变暗
        tl.to("#c-0-0, #c-0-1, #c-0-2", { opacity: 0.3, duration: 0.5 });
        
        // 高亮 0.95 那个格子
        tl.to("#c-1-2", { 
            className: "cell grid-cell high-score", // 切换 class
            duration: 0.3,
            color: "#78350f"
        });

    }
</script>
</body>
</html>